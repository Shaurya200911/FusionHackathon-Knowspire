{% extends "base.html" %}
{% load static %}

{% block head %}
<title>{{ skill.title }} ‚Äì KnowSpire</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  :root {
    --bg: #ffffff;
    --text: #000000;
    --card-bg: #f8f9fa;
    --accent: #6366f1;
    --sidebar-bg: #f8f9fa;
    --sidebar-text: #000000;
    --sidebar-hover: #e2e8f0;
  }

  [data-theme="dark"] {
    --bg: #0d1117;
    --text: #ffffff;
    --card-bg: #161b22;
    --accent: #a78bfa;
    --sidebar-bg: #1e293b;
    --sidebar-text: #ffffff;
    --sidebar-hover: #334155;
  }

  html, body {
    background-color: var(--bg);
    color: var(--text);
  }
  .flashcard, .quiz-block, .lesson-item {
    background: var(--card-bg);
    border: 1px solid var(--accent);
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
  }
  .dashboard-layout {
    display: flex;
  }
  .sidebar {
    width: 250px;
    background-color: var(--sidebar-bg);
    padding: 20px;
    min-height: 100vh;
  }
  .sidebar-link {
    display: block;
    color: var(--sidebar-text);
    padding: 10px;
    margin-bottom: 10px;
    text-decoration: none;
    border-radius: 5px;
  }
  .sidebar-link:hover {
    background-color: var(--sidebar-hover);
  }
  .main-content {
    flex-grow: 1;
    padding: 40px;
  }
  .theme-toggle {
    margin-top: 20px;
  }
</style>
{% endblock %}

{% block body %}
<div id="theme-root" data-theme="light" class="dashboard-layout">
  <div class="sidebar">
    <div class="text-center mt-4">
      <img src="{% static 'assets/images/img_header_logo.png' %}" width="80" alt="Logo">
    </div>
    <a href="{% url 'dashboard' %}" class="sidebar-link">üè† Dashboard</a>
    <a href="{% url 'skills' %}" class="sidebar-link active">üìò Skills</a>
    <a href="{% url 'leaderboard' %}" class="sidebar-link">üèÜ Leaderboard</a>
    <a href="{% url 'logout' %}" class="sidebar-link" id="logout-link">üîì Logout</a>
    <button class="theme-toggle btn btn-outline-secondary w-100" id="theme-toggle-btn">üåô Toggle Theme</button>
  </div>
  <div class="main-content">
    <div class="container" id="session-container">
      <h2 class="mb-4">{{ skill.title }} ‚Äì Lessons, Flashcards & Quizzes</h2>
      <!-- Lessons -->
      <h4>Lessons</h4>
      <div class="alert alert-warning">Lesson backend not implemented. No lessons available.</div>
      <!-- Flashcards -->
      <h4>Flashcards</h4>
      <div class="alert alert-warning">Flashcard backend not implemented. No flashcards available.</div>
      <!-- Quizzes -->
      <h4>Quizzes</h4>
      <div class="alert alert-warning">Quiz backend not implemented. No quizzes available.</div>
    </div>
  </div>
</div>
<script>
  // Theme toggle
  const root = document.getElementById('theme-root');
  const toggleBtn = document.getElementById('theme-toggle-btn');
  const savedTheme = localStorage.getItem('theme') || 'light';
  root.setAttribute('data-theme', savedTheme);
  toggleBtn.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
  toggleBtn.addEventListener('click', () => {
    const current = root.getAttribute('data-theme');
    const next = current === 'light' ? 'dark' : 'light';
    root.setAttribute('data-theme', next);
    localStorage.setItem('theme', next);
    toggleBtn.textContent = next === 'dark' ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
  });

  // Flashcard show/hide
  document.querySelectorAll('.show-back').forEach(btn => {
    btn.addEventListener('click', function() {
      const span = this.closest('.mt-2').querySelector('.back-text');
      if (span.style.display === 'none') {
        span.style.display = 'inline';
        this.textContent = 'Hide';
      } else {
        span.style.display = 'none';
        this.textContent = 'Show';
      }
    });
  });

  // Quiz submit
  document.querySelectorAll('.submit-quiz').forEach(btn => {
    btn.addEventListener('click', function() {
      const form = this.closest('form');
      const correct = this.getAttribute('data-correct');
      const selected = form.querySelector('input[type=radio]:checked');
      const result = form.querySelector('.quiz-result');
      if (!selected) {
        result.textContent = 'Select an answer!';
        result.style.color = 'orange';
        return;
      }
      if (selected.value === correct) {
        result.textContent = '‚úÖ Correct!';
        result.style.color = 'green';
      } else {
        result.textContent = '‚ùå Incorrect! Correct: ' + correct;
        result.style.color = 'red';
      }
    });
  });
  // Lesson quiz submit
  document.querySelectorAll('.submit-lesson-quiz').forEach(btn => {
    btn.addEventListener('click', function() {
      const form = this.closest('form');
      const correct = this.getAttribute('data-correct');
      const selected = form.querySelector('input[type=radio]:checked');
      const result = form.querySelector('.lesson-quiz-result');
      if (!selected) {
        result.textContent = 'Select an answer!';
        result.style.color = 'orange';
        return;
      }
      if (selected.value === correct) {
        result.textContent = '‚úÖ Correct!';
        result.style.color = 'green';
      } else {
        result.textContent = '‚ùå Incorrect! Correct: ' + correct;
        result.style.color = 'red';
      }
    });
  });
  document.getElementById('logout-link').addEventListener('click', function(e) {
    // No preventDefault, just follow the link (GET request)
  });
</script>
{% endblock %}
