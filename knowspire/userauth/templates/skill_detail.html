{% extends "base.html" %}
{% load static %}

{% block head %}
<title>{{ skill.title }} ‚Äì KnowSpire</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
  :root {
    --bg: #ffffff;
    --text: #000000;
    --card-bg: #f8f9fa;
    --accent: #6366f1;
    --sidebar-bg: #f8f9fa;
    --sidebar-text: #000000;
    --sidebar-hover: #e2e8f0;
  }

  [data-theme="dark"] {
    --bg: #0d1117;
    --text: #ffffff;
    --card-bg: #161b22;
    --accent: #a78bfa;
    --sidebar-bg: #1e293b;
    --sidebar-text: #ffffff;
    --sidebar-hover: #334155;
  }

  html, body {
    background-color: var(--bg);
    color: var(--text);
  }
  .flashcard, .quiz-block, .lesson-item {
    background: var(--card-bg);
    border: 1px solid var(--accent);
    padding: 20px;
    border-radius: 10px;
    margin-bottom: 20px;
  }
  .dashboard-layout {
    display: flex;
  }
  .sidebar {
    width: 250px;
    background-color: var(--sidebar-bg);
    padding: 20px;
    min-height: 100vh;
  }
  .sidebar-link {
    display: block;
    color: var(--sidebar-text);
    padding: 10px;
    margin-bottom: 10px;
    text-decoration: none;
    border-radius: 5px;
  }
  .sidebar-link:hover {
    background-color: var(--sidebar-hover);
  }
  .main-content {
    flex-grow: 1;
    padding: 40px;
  }
  .theme-toggle {
    margin-top: 20px;
  }
</style>
{% endblock %}

{% block body %}
<div id="theme-root" data-theme="light" class="dashboard-layout">
  <div class="sidebar">
    <div class="text-center mt-4">
      <img src="{% static 'assets/images/img_header_logo.png' %}" width="80" alt="Logo">
    </div>
    <a href="{% url 'dashboard' %}" class="sidebar-link">üè† Dashboard</a>
    <a href="{% url 'skills' %}" class="sidebar-link active">üìò Skills</a>
    <a href="{% url 'leaderboard' %}" class="sidebar-link">üèÜ Leaderboard</a>
    <a href="{% url 'logout' %}" class="sidebar-link">üîì Logout</a>
    <button class="theme-toggle btn btn-outline-secondary w-100" id="theme-toggle-btn">üåô Toggle Theme</button>
  </div>
  <div class="main-content">
    <div class="container" id="session-container">
      <h2 class="mb-4">{{ skill.title }} ‚Äì Lessons, Flashcards & Quizzes</h2>
      <!-- Lessons -->
      <h4>Lessons</h4>
      <div class="row">
        {% for ls in lessons %}
        <div class="col-md-12">
          <div class="lesson-item">
            {% if ls.type == 'teach' %}
              <h5>üìö Teaching Point</h5>
              <p>{{ ls.content }}</p>
            {% else %}
              <div><strong>{{ ls.question }}</strong></div>
              <form class="lesson-quiz-form mt-2">
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="lessonquiz{{ forloop.counter }}" value="{{ ls.option_1 }}"> {{ ls.option_1 }}
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="lessonquiz{{ forloop.counter }}" value="{{ ls.option_2 }}"> {{ ls.option_2 }}
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="lessonquiz{{ forloop.counter }}" value="{{ ls.option_3 }}"> {{ ls.option_3 }}
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="lessonquiz{{ forloop.counter }}" value="{{ ls.option_4 }}"> {{ ls.option_4 }}
                </div>
                <button type="button" class="btn btn-success btn-sm mt-2 submit-lesson-quiz" data-correct="{{ ls.correct_answer }}">Submit</button>
                <span class="lesson-quiz-result ms-2"></span>
              </form>
            {% endif %}
          </div>
        </div>
        {% empty %}
        <div class="col-12">No lessons yet.</div>
        {% endfor %}
      </div>
      <!-- Flashcards -->
      <h4>Flashcards</h4>
      <div class="row">
        {% for fc in flashcards %}
        <div class="col-md-6">
          <div class="flashcard">
            <div><strong>{{ fc.front_text }}</strong></div>
            <div class="mt-2 text-muted">Answer: <span style="display:none;" class="back-text">{{ fc.back_text }}</span>
              <button class="btn btn-sm btn-link show-back">Show</button>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="col-12">No flashcards yet.</div>
        {% endfor %}
      </div>
      <!-- Quizzes -->
      <h4>Quizzes</h4>
      <div class="row">
        {% for qz in quizzes %}
        <div class="col-md-6">
          <div class="quiz-block">
            <div><strong>{{ qz.question_text }}</strong></div>
            <form class="quiz-form mt-2">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="quiz{{ forloop.counter }}" value="{{ qz.option_1 }}"> {{ qz.option_1 }}
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="quiz{{ forloop.counter }}" value="{{ qz.option_2 }}"> {{ qz.option_2 }}
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="quiz{{ forloop.counter }}" value="{{ qz.option_3 }}"> {{ qz.option_3 }}
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="quiz{{ forloop.counter }}" value="{{ qz.option_4 }}"> {{ qz.option_4 }}
              </div>
              <button type="button" class="btn btn-success btn-sm mt-2 submit-quiz" data-correct="{{ qz.correct_answer }}">Submit</button>
              <span class="quiz-result ms-2"></span>
            </form>
          </div>
        </div>
        {% empty %}
        <div class="col-12">No quizzes yet.</div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
<script>
  // Theme toggle
  const root = document.getElementById('theme-root');
  const toggleBtn = document.getElementById('theme-toggle-btn');
  const savedTheme = localStorage.getItem('theme') || 'light';
  root.setAttribute('data-theme', savedTheme);
  toggleBtn.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
  toggleBtn.addEventListener('click', () => {
    const current = root.getAttribute('data-theme');
    const next = current === 'light' ? 'dark' : 'light';
    root.setAttribute('data-theme', next);
    localStorage.setItem('theme', next);
    toggleBtn.textContent = next === 'dark' ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
  });

  // Flashcard show/hide
  document.querySelectorAll('.show-back').forEach(btn => {
    btn.addEventListener('click', function() {
      const span = this.closest('.mt-2').querySelector('.back-text');
      if (span.style.display === 'none') {
        span.style.display = 'inline';
        this.textContent = 'Hide';
      } else {
        span.style.display = 'none';
        this.textContent = 'Show';
      }
    });
  });

  // Quiz submit
  document.querySelectorAll('.submit-quiz').forEach(btn => {
    btn.addEventListener('click', function() {
      const form = this.closest('form');
      const correct = this.getAttribute('data-correct');
      const selected = form.querySelector('input[type=radio]:checked');
      const result = form.querySelector('.quiz-result');
      if (!selected) {
        result.textContent = 'Select an answer!';
        result.style.color = 'orange';
        return;
      }
      if (selected.value === correct) {
        result.textContent = '‚úÖ Correct!';
        result.style.color = 'green';
      } else {
        result.textContent = '‚ùå Incorrect! Correct: ' + correct;
        result.style.color = 'red';
      }
    });
  });
  // Lesson quiz submit
  document.querySelectorAll('.submit-lesson-quiz').forEach(btn => {
    btn.addEventListener('click', function() {
      const form = this.closest('form');
      const correct = this.getAttribute('data-correct');
      const selected = form.querySelector('input[type=radio]:checked');
      const result = form.querySelector('.lesson-quiz-result');
      if (!selected) {
        result.textContent = 'Select an answer!';
        result.style.color = 'orange';
        return;
      }
      if (selected.value === correct) {
        result.textContent = '‚úÖ Correct!';
        result.style.color = 'green';
      } else {
        result.textContent = '‚ùå Incorrect! Correct: ' + correct;
        result.style.color = 'red';
      }
    });
  });
</script>
{% endblock %}
